"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1757],{1757:(e,t,r)=>{r.d(t,{SupabaseDatabase:()=>a});class a{constructor(e){this.client=null,this.config=e}async connect(){try{try{let{createClient:e}=await Promise.resolve().then(function(){var e=Error("Cannot find module '@supabase/supabase-js'");throw e.code="MODULE_NOT_FOUND",e});return this.client=e(this.config.url,this.config.anonKey||this.config.serviceKey),!0}catch(e){return console.warn("Supabase package not installed. Install with: npm install @supabase/supabase-js"),!1}}catch(e){return console.error("Supabase connection failed:",e),!1}}async disconnect(){this.client=null}async testConnection(){try{if(!this.client)return!1;let{data:e,error:t}=await this.client.auth.getSession();return!t||"Network request failed"!==t.message}catch(e){return console.error("Supabase connection test failed:",e),!1}}async create(e,t){try{let r={...t,created_at:t.createdAt||new Date().toISOString(),updated_at:new Date().toISOString()};Object.keys(r).forEach(e=>{void 0===r[e]&&delete r[e]});let{data:a,error:s}=await this.client.from(e).insert([r]).select().single();if(s)throw console.error("Supabase create error:",s),Error(`Supabase create failed: ${s.message}`);return a}catch(e){throw console.error("Supabase create failed:",e),e}}async read(e,t){try{if(t){let{data:r,error:a}=await this.client.from(e).select("*").eq("id",t).single();if(a&&"PGRST116"!==a.code)throw Error(`Supabase read failed: ${a.message}`);return r||null}{let{data:t,error:r}=await this.client.from(e).select("*");if(r)throw Error(`Supabase read failed: ${r.message}`);return{[e]:t||[]}}}catch(e){throw console.error("Supabase read failed:",e),e}}async update(e,t,r){try{let a={...r,updated_at:new Date().toISOString()};Object.keys(a).forEach(e=>{void 0===a[e]&&delete a[e]});let{data:s,error:n}=await this.client.from(e).update(a).eq("id",t).select().single();if(n)throw Error(`Supabase update failed: ${n.message}`);return s}catch(e){throw console.error("Supabase update failed:",e),e}}async delete(e,t){try{let{error:r}=await this.client.from(e).delete().eq("id",t);if(r)return console.error("Supabase delete error:",r),!1;return!0}catch(e){return console.error("Supabase delete failed:",e),!1}}async query(e,t){try{let r=this.client.from(e).select("*");t&&Object.keys(t).forEach(e=>{let a=t[e];if(null!=a)if("_orderBy"===e){let{field:e,direction:t="asc"}=a;r=r.order(e,{ascending:"asc"===t})}else if("_limit"===e)r=r.limit(a);else if("_range"===e){let{from:e,to:t}=a;r=r.range(e,t)}else r="string"==typeof a&&a.includes("%")?r.ilike(e,a):r.eq(e,a)});let{data:a,error:s}=await r;if(s)throw Error(`Supabase query failed: ${s.message}`);return a||[]}catch(e){throw console.error("Supabase query failed:",e),e}}async count(e,t){try{let r=this.client.from(e).select("*",{count:"exact",head:!0});t&&Object.keys(t).forEach(e=>{let a=t[e];null!=a&&"_orderBy"!==e&&"_limit"!==e&&"_range"!==e&&(r="string"==typeof a&&a.includes("%")?r.ilike(e,a):r.eq(e,a))});let{count:a,error:s}=await r;if(s)throw Error(`Supabase count failed: ${s.message}`);return a||0}catch(e){return console.error("Supabase count failed:",e),0}}async backup(){try{let e={};for(let t of["services","bookings","customers","users","messages","notifications"])try{let r=await this.read(t);e[t]=r[t]}catch(r){console.warn(`Failed to backup table ${t}:`,r),e[t]=[]}return e}catch(e){throw console.error("Supabase backup failed:",e),e}}async restore(e){try{for(let[t,r]of Object.entries(e))if(Array.isArray(r)&&r.length>0){let{error:e}=await this.client.from(t).insert(r);if(e)return console.error(`Failed to restore table ${t}:`,e),!1}return!0}catch(e){return console.error("Supabase restore failed:",e),!1}}}}}]);